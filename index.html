<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visualizador de Trabalhos</title>
    <!-- Adicionando a biblioteca Chart.js para gráficos -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Variáveis de cor */
        :root {
            --cor-primaria: #3498db;
            --cor-secundaria: #2980b9;
            --cor-texto-claro: #ecf0f1;
            --cor-texto-escuro: #2c3e50;
            --cor-fundo: #f9f9f9;
            --cor-linha-par: #f2f2f2;
            --cor-linha-hover: #e9f7fe;
            --cor-borda: #ddd;
            --cor-erro: #e74c3c;
            --cor-sucesso: #2ecc71;
        }

        /* Aplicando box-sizing a todos os elementos para melhor controle do tamanho */
        * {
            box-sizing: border-box;
        }

        /* Estilos gerais */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: var(--cor-fundo);
            color: var(--cor-texto-escuro);
            line-height: 1.6;
        }

        h1 {
            color: var(--cor-texto-escuro);
            text-align: center;
            margin-bottom: 30px;
            font-weight: 600;
        }

        /* Estilos para a tela de login */
        .tela-login {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--cor-fundo);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .container-login {
            background-color: white;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            width: 90%;
            max-width: 400px;
            text-align: center;
        }

        .container-login h2 {
            margin-top: 0;
            color: var(--cor-texto-escuro);
        }

        .container-login p {
            margin-bottom: 20px;
            color: var(--cor-texto-escuro);
        }

        .form-login {
            display: flex;
            flex-direction: column;
        }

        .form-login input {
            padding: 12px;
            margin-bottom: 15px;
            border: 1px solid var(--cor-borda);
            border-radius: 4px;
            font-size: 16px;
        }

        .form-login button {
            background-color: var(--cor-primaria);
            color: var(--cor-texto-claro);
            border: none;
            border-radius: 4px;
            padding: 12px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .form-login button:hover {
            background-color: var(--cor-secundaria);
        }

        .erro-senha {
            color: var(--cor-erro);
            margin-top: 10px;
            font-size: 14px;
            display: none;
        }

        /* Ocultar o conteúdo principal até autenticar */
        .conteudo-principal {
            display: none;
        }

        /* Quando autenticado, exibir o conteúdo principal */
        .autenticado .conteudo-principal {
            display: block;
        }

        /* Quando autenticado, ocultar a tela de login */
        .autenticado .tela-login {
            display: none;
        }

        /* Estilos para os controles de filtro */
        .painel-filtros {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            width: 100%;
        }

        .filtros-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            width: 100%;
        }

        .grupo-filtro {
            margin-bottom: 15px;
            width: 100%;
            overflow: hidden;
            /* Previne ultrapassagem do grid */
        }

        .grupo-filtro label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .grupo-filtro select,
        .grupo-filtro input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid var(--cor-borda);
            border-radius: 4px;
            font-size: 14px;
            min-width: 0;
            /* Permite que o input encolha quando necessário */
        }

        .botoes-filtro {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
        }

        button {
            background-color: var(--cor-primaria);
            color: var(--cor-texto-claro);
            border: none;
            border-radius: 4px;
            padding: 10px 20px;
            cursor: pointer;
            font-size: 15px;
            transition: background-color 0.2s;
        }

        button:hover {
            background-color: var(--cor-secundaria);
        }

        button.limpar {
            background-color: #95a5a6;
        }

        button.limpar:hover {
            background-color: #7f8c8d;
        }

        /* Estilos para estatísticas */
        .estatisticas {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .card-estatistica {
            background-color: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            min-width: 150px;
            text-align: center;
            margin: 10px;
        }

        .numero-estatistica {
            font-size: 24px;
            font-weight: bold;
            color: var(--cor-primaria);
        }

        /* Estilos para a seção de gráficos */
        .painel-graficos {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .controles-grafico {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 20px;
        }

        .controle-grafico {
            flex: 1;
            min-width: 200px;
        }

        .container-grafico {
            position: relative;
            height: 400px;
            width: 100%;
        }

        .tipo-grafico-opcoes {
            display: flex;
            gap: 15px;
            margin-bottom: 10px;
        }

        .tipo-grafico-opcao {
            display: flex;
            align-items: center;
            cursor: pointer;
        }

        .tipo-grafico-opcao input {
            margin-right: 5px;
        }

        .sem-dados-grafico {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 400px;
            color: #7f8c8d;
            font-style: italic;
        }

        /* Estilos para a tabela */
        .container-tabela {
            overflow-x: auto;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin-top: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            background-color: var(--cor-primaria);
            color: var(--cor-texto-claro);
            padding: 12px 15px;
            text-align: left;
            white-space: nowrap;
            cursor: pointer;
        }

        th:hover {
            background-color: var(--cor-secundaria);
        }

        td {
            padding: 10px 15px;
            border-bottom: 1px solid var(--cor-borda);
        }

        tr:nth-child(even) {
            background-color: var(--cor-linha-par);
        }

        tr:hover {
            background-color: var(--cor-linha-hover);
        }

        /* Indicador de ordenação */
        .ordem-asc::after {
            content: " ▲";
        }

        .ordem-desc::after {
            content: " ▼";
        }

        /* Estilos para mensagens */
        .mensagem {
            padding: 15px;
            border-radius: 4px;
            margin: 15px 0;
            text-align: center;
        }

        .erro {
            background-color: rgba(231, 76, 60, 0.2);
            color: var(--cor-erro);
        }

        .info {
            background-color: rgba(52, 152, 219, 0.2);
            color: var(--cor-primaria);
        }

        /* Estilos para paginação */
        .navegacao-paginacao {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
            padding: 10px 20px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .info-paginacao {
            font-size: 14px;
        }

        .controles-paginacao {
            display: flex;
            align-items: center;
        }

        .botao-paginacao {
            background-color: var(--cor-primaria);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 8px 12px;
            margin: 0 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.2s;
        }

        .botao-paginacao:hover:not(:disabled) {
            background-color: var(--cor-secundaria);
        }

        .botao-paginacao:disabled {
            background-color: #95a5a6;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .botao-pagina {
            background-color: white;
            color: var(--cor-texto-escuro);
            border: 1px solid var(--cor-borda);
            border-radius: 4px;
            padding: 6px 10px;
            margin: 0 2px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }

        .botao-pagina.ativa {
            background-color: var(--cor-primaria);
            color: white;
            border-color: var(--cor-primaria);
        }

        .botao-pagina:hover:not(.ativa) {
            background-color: var(--cor-linha-hover);
        }

        .itens-por-pagina {
            display: flex;
            align-items: center;
            margin-left: 15px;
        }

        .itens-por-pagina select {
            margin-left: 8px;
            padding: 6px;
            border: 1px solid var(--cor-borda);
            border-radius: 4px;
        }

        /* Estilo para inputs lado a lado */
        .grupo-filtro-duplo {
            display: flex;
            gap: 10px;
            width: 100%;
        }

        .grupo-filtro-duplo input {
            flex: 1;
            min-width: 0;
            /* Permite que os inputs encolham para caber no contêiner */
            width: calc(50% - 5px);
            /* Calcula a largura considerando o gap */
        }

        /* Estilo para grupo de radio buttons */
        .grupo-radio {
            display: flex;
            gap: 15px;
        }

        .radio-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .radio-item input {
            margin: 0;
        }

        /* Responsividade */
        @media (max-width: 768px) {
            .filtros-grid {
                grid-template-columns: 1fr;
            }

            .navegacao-paginacao {
                flex-direction: column;
                gap: 10px;
            }

            .grupo-filtro-duplo {
                flex-direction: column;
                gap: 5px;
            }

            .grupo-filtro-duplo input {
                width: 100%;
            }

            .controles-grafico {
                flex-direction: column;
            }
        }
    </style>
</head>

<body>
    <!-- Tela de login -->
    <div class="tela-login">
        <div class="container-login">
            <h2>Acesso Restrito</h2>
            <p>Por favor, insira a senha para visualizar os dados.</p>
            <form class="form-login" id="formLogin" onsubmit="return verificarSenha(event)">
                <input type="password" id="senhaAcesso" placeholder="Senha de acesso" required>
                <button type="submit">Acessar</button>
            </form>
            <div class="erro-senha" id="erroSenha">Senha incorreta. Tente novamente.</div>
        </div>
    </div>

    <!-- Conteúdo principal (visível apenas após autenticação) -->
    <div class="conteudo-principal">
        <h1>Trabalhos de Extensão | YDUQS Jan/2025 a Mar/2025</h1>

        <div class="painel-filtros">
            <div class="filtros-grid">
                <div class="grupo-filtro">
                    <label for="tipoData">Tipo de data para filtro:</label>
                    <select id="tipoData">
                        <option value="avaliacao">Data de Avaliação</option>
                        <option value="criacao">Data de Criação</option>
                    </select>
                </div>

                <div class="grupo-filtro">
                    <label for="filtroAno">Filtrar por Ano:</label>
                    <input type="number" id="filtroAno" placeholder="Ex: 2025" min="2000" max="2100">
                </div>

                <div class="grupo-filtro">
                    <label for="filtroMes">Filtrar por Mês:</label>
                    <select id="filtroMes">
                        <option value="">Todos os meses</option>
                        <option value="1">Janeiro</option>
                        <option value="2">Fevereiro</option>
                        <option value="3">Março</option>
                        <option value="4">Abril</option>
                        <option value="5">Maio</option>
                        <option value="6">Junho</option>
                        <option value="7">Julho</option>
                        <option value="8">Agosto</option>
                        <option value="9">Setembro</option>
                        <option value="10">Outubro</option>
                        <option value="11">Novembro</option>
                        <option value="12">Dezembro</option>
                    </select>
                </div>

                <div class="grupo-filtro">
                    <label for="filtroProgressoMin">Filtrar por Progresso (%):</label>
                    <div class="grupo-filtro-duplo">
                        <input type="number" id="filtroProgressoMin" min="0" max="100" placeholder="Mínimo" step="1">
                        <input type="number" id="filtroProgressoMax" min="0" max="100" placeholder="Máximo" step="1">
                    </div>
                </div>

                <div class="grupo-filtro">
                    <label for="filtroAvaliacao">Status de Avaliação:</label>
                    <select id="filtroAvaliacao">
                        <option value="">Todos</option>
                        <option value="avaliado">Avaliados</option>
                        <option value="naoAvaliado">Não avaliados</option>
                    </select>
                </div>

                <div class="grupo-filtro">
                    <label for="tipoNota">Tipo de Nota:</label>
                    <select id="tipoNota">
                        <option value="real">Nota Real</option>
                        <option value="ajustada">Nota Ajustada</option>
                    </select>
                </div>

                <div class="grupo-filtro">
                    <label for="filtroNotaMin">Nota Mínima:</label>
                    <input type="number" id="filtroNotaMin" min="0" max="10" step="0.1" placeholder="Mínimo">
                </div>

                <div class="grupo-filtro">
                    <label for="filtroNotaMax">Nota Máxima:</label>
                    <input type="number" id="filtroNotaMax" min="0" max="10" step="0.1" placeholder="Máximo">
                </div>
            </div>

            <div class="botoes-filtro">
                <button id="aplicarFiltros">Aplicar Filtros</button>
                <button id="exportarCSV" style="background-color: var(--cor-sucesso);">Exportar Dados</button>
                <button id="limparFiltros" class="limpar">Limpar Filtros</button>
            </div>
        </div>

        <div class="estatisticas">
            <div class="card-estatistica">
                <div>Total de Trabalhos</div>
                <div class="numero-estatistica" id="totalTrabalhos">0</div>
            </div>
            <div class="card-estatistica">
                <div>Média de Notas</div>
                <div class="numero-estatistica" id="mediaNota">0.0</div>
            </div>
            <div class="card-estatistica">
                <div>Trabalhos Avaliados</div>
                <div class="numero-estatistica" id="trabalhosAvaliados">0</div>
            </div>
            <div class="card-estatistica">
                <div>Trabalhos 100% Concluídos</div>
                <div class="numero-estatistica" id="trabalhosConcluidos">0</div>
            </div>
        </div>

        <!-- Seção de gráficos -->
        <div class="painel-graficos">
            <h2>Visualização Gráfica</h2>
            <div class="controles-grafico">
                <div class="controle-grafico">
                    <label>Tipo de Gráfico:</label>
                    <div class="tipo-grafico-opcoes">
                        <label class="tipo-grafico-opcao">
                            <input type="radio" name="tipoGrafico" value="linha" checked> Linha
                        </label>
                        <label class="tipo-grafico-opcao">
                            <input type="radio" name="tipoGrafico" value="barra"> Barra
                        </label>
                        <label class="tipo-grafico-opcao">
                            <input type="radio" name="tipoGrafico" value="pizza"> Pizza
                        </label>
                    </div>
                </div>
                <div class="controle-grafico">
                    <label for="colunasEixoX">Dados para Eixo X (ou categorias):</label>
                    <select id="colunasEixoX" class="select-coluna">
                        <option value="id">ID</option>
                        <option value="nota_real">Nota Real</option>
                        <option value="nota_ajustada">Nota Ajustada</option>
                        <option value="data_criacao">Data de Criação</option>
                        <option value="progresso" selected>Progresso</option>
                        <option value="periodo_academico">Período Acadêmico</option>
                        <option value="nome_disciplina">Nome da Disciplina</option>
                        <option value="data_avaliacao">Data de Avaliação</option>
                    </select>
                </div>
                <div class="controle-grafico">
                    <label for="colunasEixoY">Dados para Eixo Y (ou valores):</label>
                    <select id="colunasEixoY" class="select-coluna">
                        <option value="id">ID</option>
                        <option value="nota_real" selected>Nota Real</option>
                        <option value="nota_ajustada">Nota Ajustada</option>
                        <option value="progresso">Progresso</option>
                    </select>
                </div>
                <div class="controle-grafico">
                    <button id="gerarGrafico" class="botao-gerar-grafico">Gerar Gráfico</button>
                </div>
            </div>
            <div class="container-grafico">
                <canvas id="graficoTrabalhos"></canvas>
                <div class="sem-dados-grafico" style="display: none;">
                    Não há dados suficientes para gerar o gráfico.
                </div>
            </div>
        </div>

        <div class="container-tabela">
            <table id="tabelaTrabalhos">
                <thead>
                    <tr>
                        <th data-coluna="id">ID</th>
                        <th data-coluna="notaReal">Nota Real</th>
                        <th data-coluna="notaAjustada">Nota Ajustada</th>
                        <th data-coluna="dataCriacao">Data de Criação</th>
                        <th data-coluna="progresso">Progresso</th>
                        <th data-coluna="periodoAcademico">Período Acadêmico</th>
                        <th data-coluna="nomeDisciplina">Nome da Disciplina</th>
                        <th data-coluna="dataAvaliacao">Data de Avaliação</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Dados serão inseridos via JavaScript -->
                </tbody>
            </table>
        </div>

        <!-- Novo componente de paginação -->
        <div class="navegacao-paginacao">
            <div class="info-paginacao">
                <span id="indicadorPaginas">Exibindo 0-0 de 0 registros</span>
            </div>
            <div class="controles-paginacao">
                <div id="botoesPaginas">
                    <!-- Botões de paginação serão inseridos via JavaScript -->
                </div>
                <div class="itens-por-pagina">
                    <label for="itensPorPagina">Itens por página:</label>
                    <select id="itensPorPagina">
                        <option value="10">10</option>
                        <option value="25">25</option>
                        <option value="50">50</option>
                        <option value="100">100</option>
                    </select>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Senha para acesso ao conteúdo
        const SENHA_CORRETA = "yduqs2025";

        /**
         * Função para verificar a senha informada
         * @param {Event} event - Evento de submissão do formulário
         * @returns {boolean} - Sempre retorna false para evitar o recarregamento da página
         */
        function verificarSenha(event) {
            event.preventDefault();

            const senhaInformada = document.getElementById('senhaAcesso').value;

            if (senhaInformada === SENHA_CORRETA) {
                // Senha correta, exibir conteúdo
                document.body.classList.add('autenticado');

                // Armazenar no sessionStorage que o usuário está autenticado
                sessionStorage.setItem('autenticado', 'true');

                // Iniciar a aplicação
                iniciarAplicacao();
            } else {
                // Senha incorreta, mostrar mensagem de erro
                document.getElementById('erroSenha').style.display = 'block';
                document.getElementById('senhaAcesso').value = '';
                document.getElementById('senhaAcesso').focus();
            }

            return false;
        }

        /**
         * Função para verificar se o usuário já está autenticado ao carregar a página
         */
        function verificarAutenticacao() {
            if (sessionStorage.getItem('autenticado') === 'true') {
                document.body.classList.add('autenticado');
                iniciarAplicacao();
            }
        }

        /**
         * Função para iniciar a aplicação após autenticação
         */
        function iniciarAplicacao() {
            // Carregar dados e inicializar a aplicação
            carregarDados();
        }

        // Verificar autenticação ao carregar a página
        document.addEventListener('DOMContentLoaded', verificarAutenticacao);

        /**
         * Estado global da aplicação
         * Utilizando um objeto imutável para armazenar o estado
         */
        const Estado = {
            trabalhos: [],
            trabalhosFiltrados: [],
            colunaOrdenacao: 'id',
            direcaoOrdenacao: 'asc',
            filtros: {
                tipoData: 'avaliacao',
                ano: '',
                mes: '',
                progressoMin: '',
                progressoMax: '',
                avaliacao: '',
                tipoNota: 'real',
                notaMin: '',
                notaMax: ''
            },
            // Parâmetros de paginação
            paginacao: {
                paginaAtual: 1,
                itensPorPagina: 10,
                totalPaginas: 1
            },
            // Instância do gráfico
            grafico: null
        };

        /**
         * Função pura para formatar uma data como string
         * @param {string|null} dataStr - String de data ISO ou null
         * @returns {string} - Data formatada ou texto indicando ausência
         */
        const formatarData = (dataStr) => {
            if (!dataStr) return "Não disponível";
            const data = new Date(dataStr);
            return data.toLocaleDateString('pt-BR') + ' ' + data.toLocaleTimeString('pt-BR');
        };

        /**
         * Função pura para formatar data somente com dia/mês para uso em gráficos
         * @param {string|null} dataStr - String de data ISO ou null
         * @returns {string} - Data formatada como DD/MM ou texto indicando ausência
         */
        const formatarDataCurta = (dataStr) => {
            if (!dataStr) return "N/D";
            const data = new Date(dataStr);
            return `${data.getDate().toString().padStart(2, '0')}/${(data.getMonth() + 1).toString().padStart(2, '0')}`;
        };

        /**
         * Função pura para extrair o ano de uma data
         * @param {string|null} dataStr - String de data ISO ou null
         * @returns {number|null} - Ano extraído ou null
         */
        const extrairAno = (dataStr) => {
            if (!dataStr) return null;
            return new Date(dataStr).getFullYear();
        };

        /**
         * Função pura para extrair o mês de uma data
         * @param {string|null} dataStr - String de data ISO ou null
         * @returns {number|null} - Mês extraído (1-12) ou null
         */
        const extrairMes = (dataStr) => {
            if (!dataStr) return null;
            return new Date(dataStr).getMonth() + 1;
        };

        /**
         * Função pura para formatar um número como string
         * @param {number|null} valor - Valor numérico ou null
         * @returns {string} - Valor formatado ou texto indicando ausência
         */
        const formatarNumero = (valor) => {
            if (valor === null || valor === undefined) return "Não disponível";
            return Number(valor).toFixed(2);
        };

        /**
         * Função pura para formatar o progresso como string
         * @param {number|null} valor - Valor do progresso ou null
         * @returns {string} - Progresso formatado ou texto indicando ausência
         */
        const formatarProgresso = (valor) => {
            if (valor === null || valor === undefined) return "Não disponível";
            return `${valor}%`;
        };

        /**
         * Função pura para obter o valor de nota conforme tipo selecionado
         * @param {Object} trabalho - Objeto trabalho com as notas
         * @param {string} tipo - Tipo de nota (real ou ajustada)
         * @returns {number|null} - Valor da nota ou null
         */
        const obterValorNota = (trabalho, tipo) => {
            return tipo === 'real' ? trabalho.nota_real : trabalho.nota_ajustada;
        };

        /**
         * Função pura para calcular estatísticas dos trabalhos
         * @param {Array} trabalhos - Lista de trabalhos
         * @param {string} tipoNota - Tipo de nota para cálculo de média
         * @returns {Object} - Objeto com as estatísticas calculadas
         */
        const calcularEstatisticas = (trabalhos, tipoNota) => {
            const total = trabalhos.length;

            const trabalhosComNota = trabalhos.filter(
                t => obterValorNota(t, tipoNota) !== null &&
                    obterValorNota(t, tipoNota) !== undefined
            );

            const avaliados = trabalhos.filter(t => t.data_avaliacao !== null).length;
            const concluidos = trabalhos.filter(t => t.progresso === 100).length;

            const somaNotas = trabalhosComNota.reduce(
                (soma, t) => soma + obterValorNota(t, tipoNota),
                0
            );

            const media = trabalhosComNota.length > 0
                ? somaNotas / trabalhosComNota.length
                : 0;

            return {
                total,
                media,
                avaliados,
                concluidos
            };
        };

        /**
         * Função pura para atualizar o DOM com as estatísticas
         * @param {Object} estatisticas - Objeto com estatísticas
         */
        const atualizarEstatisticasDOM = (estatisticas) => {
            document.getElementById('totalTrabalhos').textContent = estatisticas.total;
            document.getElementById('mediaNota').textContent = estatisticas.media.toFixed(2);
            document.getElementById('trabalhosAvaliados').textContent = estatisticas.avaliados;
            document.getElementById('trabalhosConcluidos').textContent = estatisticas.concluidos;
        };

        /**
         * Função pura para filtrar trabalhos com base nos critérios
         * @param {Array} trabalhos - Lista de trabalhos para filtrar
         * @param {Object} filtros - Critérios de filtragem
         * @returns {Array} - Lista filtrada de trabalhos
         */
        const filtrarTrabalhos = (trabalhos, filtros) => {
            return trabalhos.filter(trabalho => {
                // Filtro por ano e mês conforme o tipo de data selecionado
                const dataCampo = filtros.tipoData === 'avaliacao' ?
                    trabalho.data_avaliacao : trabalho.data_criacao;

                // Filtro por ano - ignorar registros com data null se houver filtro de ano
                if (filtros.ano && filtros.ano !== '') {
                    if (dataCampo === null || dataCampo === undefined) {
                        return false; // Ignorar registros com data null quando há filtro de ano
                    }
                    const anoData = extrairAno(dataCampo);
                    if (anoData !== parseInt(filtros.ano)) {
                        return false;
                    }
                }

                // Filtro por mês - ignorar registros com data null se houver filtro de mês
                if (filtros.mes && filtros.mes !== '') {
                    if (dataCampo === null || dataCampo === undefined) {
                        return false; // Ignorar registros com data null quando há filtro de mês
                    }
                    const mesData = extrairMes(dataCampo);
                    if (mesData !== parseInt(filtros.mes)) {
                        return false;
                    }
                }

                // Filtro por progresso mínimo - ignorar registros com progresso null
                if (filtros.progressoMin !== '') {
                    if (trabalho.progresso === null || trabalho.progresso === undefined) {
                        return false; // Ignorar registros com progresso null quando há filtro mínimo
                    }
                    if (trabalho.progresso < parseInt(filtros.progressoMin)) {
                        return false;
                    }
                }

                // Filtro por progresso máximo - ignorar registros com progresso null
                if (filtros.progressoMax !== '') {
                    if (trabalho.progresso === null || trabalho.progresso === undefined) {
                        return false; // Ignorar registros com progresso null quando há filtro máximo
                    }
                    if (trabalho.progresso > parseInt(filtros.progressoMax)) {
                        return false;
                    }
                }

                // Filtro por status de avaliação
                if (filtros.avaliacao === 'avaliado') {
                    if (!trabalho.data_avaliacao) return false;
                } else if (filtros.avaliacao === 'naoAvaliado') {
                    if (trabalho.data_avaliacao) return false;
                }

                // Filtro por nota mínima e máxima
                const tipoNota = filtros.tipoNota || 'real';
                const valorNota = obterValorNota(trabalho, tipoNota);

                // Filtro por nota mínima - ignorar registros com nota null
                if (filtros.notaMin !== '') {
                    if (valorNota === null || valorNota === undefined) {
                        return false; // Ignorar registros com nota null quando há filtro mínimo
                    }
                    if (valorNota < parseFloat(filtros.notaMin)) {
                        return false;
                    }
                }

                // Filtro por nota máxima - ignorar registros com nota null
                if (filtros.notaMax !== '') {
                    if (valorNota === null || valorNota === undefined) {
                        return false; // Ignorar registros com nota null quando há filtro máximo
                    }
                    if (valorNota > parseFloat(filtros.notaMax)) {
                        return false;
                    }
                }

                return true;
            });
        };

        /**
         * Função pura para ordenar trabalhos
         * @param {Array} trabalhos - Lista de trabalhos para ordenar
         * @param {string} coluna - Nome da coluna para ordenação
         * @param {string} direcao - Direção da ordenação (asc ou desc)
         * @returns {Array} - Lista ordenada (nova instância)
         */
        const ordenarTrabalhos = (trabalhos, coluna, direcao) => {
            const mapeamentoColunas = {
                'id': 'id',
                'notaReal': 'nota_real',
                'notaAjustada': 'nota_ajustada',
                'dataCriacao': 'data_criacao',
                'progresso': 'progresso',
                'periodoAcademico': 'periodo_academico',
                'nomeDisciplina': 'nome_disciplina',
                'dataAvaliacao': 'data_avaliacao'
            };

            const campoOrdenacao = mapeamentoColunas[coluna];

            return [...trabalhos].sort((a, b) => {
                let valorA = a[campoOrdenacao];
                let valorB = b[campoOrdenacao];

                // Tratar valores null ou undefined para comparação
                if (valorA === null || valorA === undefined) return direcao === 'asc' ? -1 : 1;
                if (valorB === null || valorB === undefined) return direcao === 'asc' ? 1 : -1;

                // Ordenação específica para datas
                if (campoOrdenacao === 'data_criacao' || campoOrdenacao === 'data_avaliacao') {
                    valorA = new Date(valorA).getTime();
                    valorB = new Date(valorB).getTime();
                }

                // Comparação com direção
                if (valorA < valorB) return direcao === 'asc' ? -1 : 1;
                if (valorA > valorB) return direcao === 'asc' ? 1 : -1;
                return 0;
            });
        };

        /**
         * Função pura para paginar trabalhos
         * @param {Array} trabalhos - Lista de trabalhos ordenados
         * @param {number} paginaAtual - Página atual
         * @param {number} itensPorPagina - Número de itens por página
         * @returns {Array} - Lista paginada de trabalhos
         */
        const paginarTrabalhos = (trabalhos, paginaAtual, itensPorPagina) => {
            const indiceInicio = (paginaAtual - 1) * itensPorPagina;
            const indiceFim = indiceInicio + itensPorPagina;
            return trabalhos.slice(indiceInicio, indiceFim);
        };

        /**
         * Função pura para calcular o total de páginas
         * @param {number} totalItens - Total de itens
         * @param {number} itensPorPagina - Itens por página
         * @returns {number} - Total de páginas
         */
        const calcularTotalPaginas = (totalItens, itensPorPagina) => {
            return Math.ceil(totalItens / itensPorPagina) || 1;
        };

        /**
         * Função para renderizar a tabela com os trabalhos paginados
         * @param {Array} trabalhos - Lista de trabalhos para exibir
         * @param {string} tipoNota - Tipo de nota para exibir destaque
         */
        const renderizarTabela = (trabalhos, tipoNota) => {
            const tbody = document.querySelector('#tabelaTrabalhos tbody');
            tbody.innerHTML = '';

            if (trabalhos.length === 0) {
                const tr = document.createElement('tr');
                const td = document.createElement('td');
                td.colSpan = 8;
                td.textContent = 'Nenhum trabalho encontrado';
                td.style.textAlign = 'center';
                tr.appendChild(td);
                tbody.appendChild(tr);
                return;
            }

            trabalhos.forEach(trabalho => {
                const tr = document.createElement('tr');

                // Adicionando células
                const colunas = [
                    trabalho.id || 'N/A',
                    formatarNumero(trabalho.nota_real),
                    formatarNumero(trabalho.nota_ajustada),
                    formatarData(trabalho.data_criacao),
                    formatarProgresso(trabalho.progresso),
                    trabalho.periodo_academico || 'N/A',
                    trabalho.nome_disciplina || 'N/A',
                    formatarData(trabalho.data_avaliacao)
                ];

                // Destacar a coluna do tipo de nota selecionado
                const indiceDestaque = tipoNota === 'real' ? 1 : 2;

                colunas.forEach((valor, indice) => {
                    const td = document.createElement('td');
                    td.textContent = valor;

                    // Aplicar estilo destaque
                    if (indice === indiceDestaque) {
                        td.style.fontWeight = 'bold';
                        td.style.backgroundColor = '#e9f7fe';
                    }

                    tr.appendChild(td);
                });

                tbody.appendChild(tr);
            });
        };

        /**
         * Função pura para gerar a sequência de números de página para exibição
         * @param {number} paginaAtual - Página atual
         * @param {number} totalPaginas - Total de páginas
         * @param {number} maxBotoes - Máximo de botões de página para exibir
         * @returns {Array} - Array com os números de página para exibir
         */
        const gerarSequenciaPaginas = (paginaAtual, totalPaginas, maxBotoes = 5) => {
            if (totalPaginas <= maxBotoes) {
                // Se houver menos páginas que o máximo de botões, exibe todas as páginas
                return Array.from({ length: totalPaginas }, (_, i) => i + 1);
            }

            // Calcula o centro da exibição
            const metade = Math.floor(maxBotoes / 2);

            let inicio = paginaAtual - metade;
            let fim = paginaAtual + metade;

            // Ajusta os valores para exibir o máximo de botões
            if (inicio < 1) {
                fim = Math.min(totalPaginas, fim + (1 - inicio));
                inicio = 1;
            }

            if (fim > totalPaginas) {
                inicio = Math.max(1, inicio - (fim - totalPaginas));
                fim = totalPaginas;
            }

            // Gera a sequência
            return Array.from({ length: fim - inicio + 1 }, (_, i) => inicio + i);
        };

        /**
         * Função para renderizar os controles de paginação
         * @param {number} paginaAtual - Página atual
         * @param {number} totalPaginas - Total de páginas
         * @param {number} totalItens - Total de itens
         * @param {number} itensPorPagina - Itens por página
         */
        const renderizarControlesPaginacao = (paginaAtual, totalPaginas, totalItens, itensPorPagina) => {
            // Atualizar indicador de páginas
            const indiceInicio = Math.min((paginaAtual - 1) * itensPorPagina + 1, totalItens);
            const indiceFim = Math.min(paginaAtual * itensPorPagina, totalItens);

            document.getElementById('indicadorPaginas').textContent =
                `Exibindo ${indiceInicio}-${indiceFim} de ${totalItens} registros`;

            // Gerar botões de página
            const botoesPaginasContainer = document.getElementById('botoesPaginas');
            botoesPaginasContainer.innerHTML = '';

            // Botão anterior
            const btnAnterior = document.createElement('button');
            btnAnterior.className = 'botao-paginacao';
            btnAnterior.textContent = '«';
            btnAnterior.disabled = paginaAtual === 1;
            btnAnterior.addEventListener('click', () => mudarPagina(paginaAtual - 1));
            botoesPaginasContainer.appendChild(btnAnterior);

            // Botões de página
            const sequenciaPaginas = gerarSequenciaPaginas(paginaAtual, totalPaginas);

            sequenciaPaginas.forEach(numeroPagina => {
                const btnPagina = document.createElement('button');
                btnPagina.className = `botao-pagina ${numeroPagina === paginaAtual ? 'ativa' : ''}`;
                btnPagina.textContent = numeroPagina;
                btnPagina.addEventListener('click', () => mudarPagina(numeroPagina));
                botoesPaginasContainer.appendChild(btnPagina);
            });

            // Botão próximo
            const btnProximo = document.createElement('button');
            btnProximo.className = 'botao-paginacao';
            btnProximo.textContent = '»';
            btnProximo.disabled = paginaAtual === totalPaginas;
            btnProximo.addEventListener('click', () => mudarPagina(paginaAtual + 1));
            botoesPaginasContainer.appendChild(btnProximo);
        };

        /**
         * Função para atualizar os indicadores de ordenação no cabeçalho da tabela
         * @param {string} coluna - Coluna para marcar como ordenada
         * @param {string} direcao - Direção da ordenação
         */
        const atualizarIndicadoresOrdenacao = (coluna, direcao) => {
            // Remover classes de todos os cabeçalhos
            document.querySelectorAll('#tabelaTrabalhos th').forEach(th => {
                th.classList.remove('ordem-asc', 'ordem-desc');
            });

            // Adicionar classe ao cabeçalho ordenado
            const thOrdenado = document.querySelector(`#tabelaTrabalhos th[data-coluna="${coluna}"]`);
            if (thOrdenado) {
                thOrdenado.classList.add(`ordem-${direcao}`);
            }
        };

        /**
         * Função para obter o valor de um campo específico de um trabalho
         * @param {Object} trabalho - Objeto trabalho
         * @param {string} campo - Nome do campo a ser obtido
         * @returns {any} - Valor do campo
         */
        const obterValorCampo = (trabalho, campo) => {
            switch (campo) {
                case 'id':
                    return trabalho.id;
                case 'nota_real':
                    return trabalho.nota_real;
                case 'nota_ajustada':
                    return trabalho.nota_ajustada;
                case 'progresso':
                    return trabalho.progresso;
                case 'data_criacao':
                    return trabalho.data_criacao ? new Date(trabalho.data_criacao) : null;
                case 'data_avaliacao':
                    return trabalho.data_avaliacao ? new Date(trabalho.data_avaliacao) : null;
                case 'periodo_academico':
                    return trabalho.periodo_academico;
                case 'nome_disciplina':
                    return trabalho.nome_disciplina;
                default:
                    return null;
            }
        };

        /**
         * Função para formatar valores para exibição no gráfico
         * @param {any} valor - Valor a ser formatado
         * @param {string} campo - Nome do campo
         * @returns {string|number} - Valor formatado
         */
        const formatarValorParaGrafico = (valor, campo) => {
            if (valor === null || valor === undefined) return 'N/D';

            if (campo === 'data_criacao' || campo === 'data_avaliacao') {
                return formatarDataCurta(valor);
            }

            if (campo === 'nota_real' || campo === 'nota_ajustada') {
                return Number(valor);
            }

            if (campo === 'progresso') {
                return Number(valor);
            }

            return valor;
        };

        /**
         * Função para agrupar dados por um campo específico (para gráficos)
         * @param {Array} trabalhos - Lista de trabalhos
         * @param {string} campoCategorias - Campo para as categorias (eixo X)
         * @param {string} campoValores - Campo para os valores (eixo Y)
         * @returns {Object} - Dados agrupados {labels, valores}
         */
        const agruparDadosParaGrafico = (trabalhos, campoCategorias, campoValores) => {
            // Objeto para armazenar os valores agrupados
            const dadosAgrupados = {};

            // Para cada trabalho, agrupar por categoria
            trabalhos.forEach(trabalho => {
                const valorCategoria = obterValorCampo(trabalho, campoCategorias);
                const valorDado = obterValorCampo(trabalho, campoValores);

                // Se algum dos valores for nulo/indefinido, pular
                if (valorCategoria === null || valorCategoria === undefined ||
                    valorDado === null || valorDado === undefined) {
                    return;
                }

                // Formata a chave da categoria para o gráfico
                const chaveCategoria = formatarValorParaGrafico(valorCategoria, campoCategorias);

                // Se a categoria já existe, adiciona o valor; senão, cria nova entrada
                if (!dadosAgrupados[chaveCategoria]) {
                    dadosAgrupados[chaveCategoria] = {
                        soma: valorDado,
                        contagem: 1
                    };
                } else {
                    dadosAgrupados[chaveCategoria].soma += valorDado;
                    dadosAgrupados[chaveCategoria].contagem++;
                }
            });

            // Extrai labels e valores médios dos dados agrupados
            const labels = Object.keys(dadosAgrupados);
            const valores = labels.map(label => {
                const grupo = dadosAgrupados[label];
                // Para campos numéricos, retornar a média
                if (campoValores === 'nota_real' || campoValores === 'nota_ajustada' || campoValores === 'progresso') {
                    return grupo.soma / grupo.contagem;
                }
                // Para outros campos, retornar a contagem
                return grupo.contagem;
            });

            return { labels, valores };
        };

        /**
         * Função para gerar cores aleatórias para o gráfico
         * @param {number} quantidade - Quantidade de cores a gerar
         * @returns {Array} - Array de strings de cores em formato rgba
         */
        const gerarCoresAleatoriasGrafico = (quantidade) => {
            const cores = [];
            for (let i = 0; i < quantidade; i++) {
                const hue = (i * 137.5) % 360; // Distribuição uniforme de cores pelo círculo cromático
                cores.push(`hsla(${hue}, 70%, 60%, 0.7)`);
            }
            return cores;
        };

        /**
         * Função para determinar o título do eixo com base no campo selecionado
         * @param {string} campo - Nome do campo
         * @returns {string} - Título para o eixo
         */
        const obterTituloEixo = (campo) => {
            const mapeamentoTitulos = {
                'id': 'ID do Trabalho',
                'nota_real': 'Nota Real',
                'nota_ajustada': 'Nota Ajustada',
                'progresso': 'Progresso (%)',
                'data_criacao': 'Data de Criação',
                'data_avaliacao': 'Data de Avaliação',
                'periodo_academico': 'Período Acadêmico',
                'nome_disciplina': 'Disciplina'
            };

            return mapeamentoTitulos[campo] || campo;
        };

        /**
         * Função para criar ou atualizar o gráfico
         * @param {Array} trabalhos - Lista de trabalhos filtrados
         * @param {string} tipoGrafico - Tipo de gráfico: linha, barra ou pizza
         * @param {string} campoCategorias - Campo para o eixo X ou categorias
         * @param {string} campoValores - Campo para o eixo Y ou valores
         */
        const criarGrafico = (trabalhos, tipoGrafico, campoCategorias, campoValores) => {
            // Verifica se há dados suficientes
            if (!trabalhos || trabalhos.length === 0) {
                document.querySelector('.sem-dados-grafico').style.display = 'flex';
                document.getElementById('graficoTrabalhos').style.display = 'none';
                // Destruir gráfico anterior se existir
                if (Estado.grafico) {
                    Estado.grafico.destroy();
                    Estado.grafico = null;
                }
                return;
            }

            // Esconder mensagem de sem dados
            document.querySelector('.sem-dados-grafico').style.display = 'none';
            document.getElementById('graficoTrabalhos').style.display = 'block';

            // Agrupar dados para o gráfico
            const { labels, valores } = agruparDadosParaGrafico(trabalhos, campoCategorias, campoValores);

            // Se não houver dados após agrupamento
            if (labels.length === 0) {
                document.querySelector('.sem-dados-grafico').style.display = 'flex';
                document.getElementById('graficoTrabalhos').style.display = 'none';
                return;
            }

            // Ordenar labels e valores correspondentes (exceto para datas)
            if (campoCategorias !== 'data_criacao' && campoCategorias !== 'data_avaliacao') {
                const indicesOrdenados = Array.from(labels.keys()).sort((a, b) => labels[a].localeCompare(labels[b]));
                const labelsOrdenados = indicesOrdenados.map(i => labels[i]);
                const valoresOrdenados = indicesOrdenados.map(i => valores[i]);

                // Atualizar labels e valores
                labels.splice(0, labels.length, ...labelsOrdenados);
                valores.splice(0, valores.length, ...valoresOrdenados);
            }

            // Gerar cores para o gráfico
            const cores = gerarCoresAleatoriasGrafico(labels.length);

            // Configuração do gráfico
            const config = {
                type: tipoGrafico === 'linha' ? 'line' : (tipoGrafico === 'barra' ? 'bar' : 'pie'),
                data: {
                    labels: labels,
                    datasets: [{
                        label: `${obterTituloEixo(campoValores)} por ${obterTituloEixo(campoCategorias)}`,
                        data: valores,
                        backgroundColor: tipoGrafico === 'linha' ? 'rgba(54, 162, 235, 0.2)' : cores,
                        borderColor: tipoGrafico === 'linha' ? 'rgba(54, 162, 235, 1)' : cores,
                        borderWidth: 1,
                        fill: tipoGrafico === 'linha',
                        tension: tipoGrafico === 'linha' ? 0.4 : undefined
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: tipoGrafico === 'pizza'
                        },
                        tooltip: {
                            enabled: true
                        }
                    }
                }
            };

            // Adicionar escalas apenas para gráficos que não são de pizza
            if (tipoGrafico !== 'pizza') {
                config.options.scales = {
                    x: {
                        title: {
                            display: true,
                            text: obterTituloEixo(campoCategorias)
                        }
                    },
                    y: {
                        title: {
                            display: true,
                            text: obterTituloEixo(campoValores)
                        },
                        beginAtZero: true
                    }
                };
            }

            // Obter contexto do canvas
            const ctx = document.getElementById('graficoTrabalhos').getContext('2d');

            // Destruir gráfico anterior se existir
            if (Estado.grafico) {
                Estado.grafico.destroy();
            }

            // Criar novo gráfico
            Estado.grafico = new Chart(ctx, config);
        };

        /**
         * Função para atualizar a visualização com base no estado atual
         * @param {Object} estado - Estado atual da aplicação
         * @returns {Object} - Novo estado atualizado
         */
        const atualizarVisualizacao = (estado) => {
            // Filtrar trabalhos conforme critérios
            const trabalhosFiltrados = filtrarTrabalhos(estado.trabalhos, estado.filtros);

            // Ordenar os trabalhos filtrados
            const trabalhosOrdenados = ordenarTrabalhos(
                trabalhosFiltrados,
                estado.colunaOrdenacao,
                estado.direcaoOrdenacao
            );

            // Calcular total de páginas
            const totalPaginas = calcularTotalPaginas(
                trabalhosOrdenados.length,
                estado.paginacao.itensPorPagina
            );

            // Ajustar página atual se necessário
            const paginaAtual = Math.min(estado.paginacao.paginaAtual, totalPaginas);

            // Obter trabalhos da página atual
            const trabalhosPaginados = paginarTrabalhos(
                trabalhosOrdenados,
                paginaAtual,
                estado.paginacao.itensPorPagina
            );

            // Renderizar tabela com os trabalhos paginados
            renderizarTabela(trabalhosPaginados, estado.filtros.tipoNota);

            // Atualizar indicadores de ordenação
            atualizarIndicadoresOrdenacao(estado.colunaOrdenacao, estado.direcaoOrdenacao);

            // Renderizar controles de paginação
            renderizarControlesPaginacao(
                paginaAtual,
                totalPaginas,
                trabalhosOrdenados.length,
                estado.paginacao.itensPorPagina
            );

            // Calcular e atualizar estatísticas
            const estatisticas = calcularEstatisticas(trabalhosOrdenados, estado.filtros.tipoNota);
            atualizarEstatisticasDOM(estatisticas);

            // Retornar novo estado com as atualizações
            return {
                ...estado,
                trabalhosFiltrados: trabalhosOrdenados,
                paginacao: {
                    ...estado.paginacao,
                    paginaAtual,
                    totalPaginas
                }
            };
        };

        /**
         * Função para gerar o gráfico com base nos filtros aplicados
         */
        const gerarGraficoComFiltros = () => {
            // Obter tipo de gráfico selecionado
            const tipoGrafico = document.querySelector('input[name="tipoGrafico"]:checked').value;

            // Obter campos selecionados para o gráfico
            const campoCategorias = document.getElementById('colunasEixoX').value;
            const campoValores = document.getElementById('colunasEixoY').value;

            // Criar gráfico com os trabalhos filtrados
            criarGrafico(Estado.trabalhosFiltrados, tipoGrafico, campoCategorias, campoValores);
        };

        /**
         * Função para buscar e carregar os dados do arquivo JSON
         */
        const carregarDados = async () => {
            try {
                const resposta = await fetch('trabalhos_filtrados.json');
                if (!resposta.ok) {
                    throw new Error(`Erro ao carregar dados: ${resposta.status}`);
                }

                const dados = await resposta.json();

                // Atualizar estado com dados carregados
                Object.assign(Estado, {
                    trabalhos: dados,
                    trabalhosFiltrados: dados
                });

                // Atualizar visualização inicial e sincronizar estado
                const novoEstado = atualizarVisualizacao(Estado);
                Object.assign(Estado, novoEstado);

                console.log(`Dados carregados: ${dados.length} trabalhos`);
            } catch (erro) {
                console.error('Erro ao carregar os dados:', erro);
                alert('Não foi possível carregar os dados. Verifique o console para mais detalhes.');
            }
        };

        /**
         * Função para aplicar filtros selecionados pelo usuário
         */
        const aplicarFiltrosUsuario = () => {
            // Criar novo objeto de filtros baseado nos valores atuais da interface
            const novosFiltros = {
                tipoData: document.getElementById('tipoData').value,
                ano: document.getElementById('filtroAno').value,
                mes: document.getElementById('filtroMes').value,
                progressoMin: document.getElementById('filtroProgressoMin').value,
                progressoMax: document.getElementById('filtroProgressoMax').value,
                avaliacao: document.getElementById('filtroAvaliacao').value,
                tipoNota: document.getElementById('tipoNota').value,
                notaMin: document.getElementById('filtroNotaMin').value,
                notaMax: document.getElementById('filtroNotaMax').value
            };

            // Atualizar estado com novos filtros e resetar para primeira página
            Object.assign(Estado, {
                filtros: novosFiltros,
                paginacao: {
                    ...Estado.paginacao,
                    paginaAtual: 1
                }
            });

            // Atualizar visualização com os novos filtros e sincronizar estado
            const novoEstado = atualizarVisualizacao(Estado);
            Object.assign(Estado, novoEstado);
        };

        /**
         * Função para limpar todos os filtros
         */
        const limparFiltros = () => {
            // Resetar os campos do formulário
            document.getElementById('tipoData').value = 'avaliacao';
            document.getElementById('filtroAno').value = '';
            document.getElementById('filtroMes').value = '';
            document.getElementById('filtroProgressoMin').value = '';
            document.getElementById('filtroProgressoMax').value = '';
            document.getElementById('filtroAvaliacao').value = '';
            document.getElementById('tipoNota').value = 'real';
            document.getElementById('filtroNotaMin').value = '';
            document.getElementById('filtroNotaMax').value = '';

            // Atualizar estado com filtros vazios e resetar para primeira página
            Object.assign(Estado, {
                filtros: {
                    tipoData: 'avaliacao',
                    ano: '',
                    mes: '',
                    progressoMin: '',
                    progressoMax: '',
                    avaliacao: '',
                    tipoNota: 'real',
                    notaMin: '',
                    notaMax: ''
                },
                paginacao: {
                    ...Estado.paginacao,
                    paginaAtual: 1
                }
            });

            // Atualizar visualização e sincronizar estado
            const novoEstado = atualizarVisualizacao(Estado);
            Object.assign(Estado, novoEstado);
        };

        /**
         * Função para alternar a ordenação ao clicar em um cabeçalho da tabela
         * @param {string} coluna - Coluna a ser ordenada
         */
        const alternarOrdenacao = (coluna) => {
            let novaOrientacao;

            // Se já estiver ordenando por esta coluna, apenas inverte a direção
            if (Estado.colunaOrdenacao === coluna) {
                novaOrientacao = Estado.direcaoOrdenacao === 'asc' ? 'desc' : 'asc';
            } else {
                // Nova coluna começa com ordenação ascendente
                novaOrientacao = 'asc';
            }

            // Atualizar estado
            Object.assign(Estado, {
                colunaOrdenacao: coluna,
                direcaoOrdenacao: novaOrientacao
            });

            // Atualizar visualização e sincronizar estado
            const novoEstado = atualizarVisualizacao(Estado);
            Object.assign(Estado, novoEstado);
        };

        /**
         * Função para mudar para uma página específica
         * @param {number} numeroPagina - Número da página para navegar
         */
        const mudarPagina = (numeroPagina) => {
            // Garantir que a página esteja dentro dos limites
            const paginaValida = Math.max(1, Math.min(numeroPagina, Estado.paginacao.totalPaginas));

            // Atualizar estado apenas se a página mudar
            if (paginaValida !== Estado.paginacao.paginaAtual) {
                Object.assign(Estado, {
                    paginacao: {
                        ...Estado.paginacao,
                        paginaAtual: paginaValida
                    }
                });

                // Atualizar visualização e sincronizar estado
                const novoEstado = atualizarVisualizacao(Estado);
                Object.assign(Estado, novoEstado);
            }
        };

        /**
         * Função para alterar a quantidade de itens por página
         * @param {number} quantidade - Nova quantidade de itens por página
         */
        const alterarItensPorPagina = (quantidade) => {
            // Atualizar estado
            Object.assign(Estado, {
                paginacao: {
                    ...Estado.paginacao,
                    itensPorPagina: quantidade,
                    paginaAtual: 1 // Voltar para primeira página ao alterar quantidade
                }
            });

            // Atualizar visualização e sincronizar estado
            const novoEstado = atualizarVisualizacao(Estado);
            Object.assign(Estado, novoEstado);
        };

        /**
         * Função para atualizar o seletor de colunas do eixo Y com base no tipo de gráfico
         */
        const atualizarSeletorEixos = () => {
            const tipoGrafico = document.querySelector('input[name="tipoGrafico"]:checked').value;
            const seletorEixoY = document.getElementById('colunasEixoY');

            // Se for gráfico de pizza, limitar as opções de valores para campos numéricos
            if (tipoGrafico === 'pizza') {
                // Limpar opções atuais
                seletorEixoY.innerHTML = '';

                // Adicionar apenas opções numéricas
                const opcoesNumericas = [
                    { valor: 'id', texto: 'ID' },
                    { valor: 'nota_real', texto: 'Nota Real' },
                    { valor: 'nota_ajustada', texto: 'Nota Ajustada' },
                    { valor: 'progresso', texto: 'Progresso' }
                ];

                opcoesNumericas.forEach(opcao => {
                    const novaOpcao = document.createElement('option');
                    novaOpcao.value = opcao.valor;
                    novaOpcao.textContent = opcao.texto;
                    if (opcao.valor === 'nota_real') {
                        novaOpcao.selected = true;
                    }
                    seletorEixoY.appendChild(novaOpcao);
                });

                // Alterar rótulo do seletor
                document.querySelector('label[for="colunasEixoY"]').textContent = 'Dados para Valores:';
                document.querySelector('label[for="colunasEixoX"]').textContent = 'Dados para Categorias:';
            } else {
                // Restaurar todas as opções para gráficos de linha e barra
                seletorEixoY.innerHTML = '';

                const opcoesCompletas = [
                    { valor: 'id', texto: 'ID' },
                    { valor: 'nota_real', texto: 'Nota Real', selecionado: true },
                    { valor: 'nota_ajustada', texto: 'Nota Ajustada' },
                    { valor: 'progresso', texto: 'Progresso' }
                ];

                opcoesCompletas.forEach(opcao => {
                    const novaOpcao = document.createElement('option');
                    novaOpcao.value = opcao.valor;
                    novaOpcao.textContent = opcao.texto;
                    if (opcao.selecionado) {
                        novaOpcao.selected = true;
                    }
                    seletorEixoY.appendChild(novaOpcao);
                });

                // Restaurar rótulos
                document.querySelector('label[for="colunasEixoY"]').textContent = 'Dados para Eixo Y (ou valores):';
                document.querySelector('label[for="colunasEixoX"]').textContent = 'Dados para Eixo X (ou categorias):';
            }
        };

        /**
         * Função para converter os dados filtrados para o formato CSV
         * @param {Array} trabalhos - Lista de trabalhos para exportar
         * @param {string} tipoNota - Tipo de nota selecionada
         * @returns {string} - String no formato CSV
         */
        const converterParaCSV = (trabalhos, tipoNota) => {
            if (!trabalhos || trabalhos.length === 0) {
                return '';
            }

            // Cabeçalho do CSV
            const cabecalhos = [
                'ID',
                'Nota Real',
                'Nota Ajustada',
                'Data de Criação',
                'Progresso',
                'Período Acadêmico',
                'Nome da Disciplina',
                'Data de Avaliação'
            ];

            // Converter cabeçalhos para linha CSV
            let csv = cabecalhos.join(',') + '\n';

            // Adicionar cada trabalho como uma linha
            trabalhos.forEach(trabalho => {
                const linha = [
                    trabalho.id || '',
                    (trabalho.nota_real !== null && trabalho.nota_real !== undefined) ? trabalho.nota_real : '',
                    (trabalho.nota_ajustada !== null && trabalho.nota_ajustada !== undefined) ? trabalho.nota_ajustada : '',
                    trabalho.data_criacao ? new Date(trabalho.data_criacao).toLocaleString('pt-BR') : '',
                    (trabalho.progresso !== null && trabalho.progresso !== undefined) ? trabalho.progresso : '',
                    trabalho.periodo_academico || '',
                    (trabalho.nome_disciplina || '').replace(/,/g, ';'), // Substituir vírgulas por ponto-e-vírgula
                    trabalho.data_avaliacao ? new Date(trabalho.data_avaliacao).toLocaleString('pt-BR') : ''
                ].map(valor => {
                    // Se o valor contiver vírgulas, aspas ou quebras de linha, coloque entre aspas duplas
                    if (typeof valor === 'string' && (valor.includes(',') || valor.includes('"') || valor.includes('\n'))) {
                        // Escape das aspas duplas
                        return '"' + valor.replace(/"/g, '""') + '"';
                    }
                    return valor;
                });

                csv += linha.join(',') + '\n';
            });

            return csv;
        };

        /**
         * Função para exportar os dados para um arquivo CSV
         */
        const exportarCSV = () => {
            // Obter trabalhos filtrados e ordenados atuais
            const trabalhos = Estado.trabalhosFiltrados;
            const tipoNota = Estado.filtros.tipoNota;

            // Converter para CSV
            const csv = converterParaCSV(trabalhos, tipoNota);

            if (!csv) {
                alert('Não há dados para exportar');
                return;
            }

            // Criar um blob com o conteúdo CSV
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });

            // Criar um URL para o blob
            const url = URL.createObjectURL(blob);

            // Criar um elemento <a> para download
            const link = document.createElement('a');
            link.setAttribute('href', url);

            // Gerar nome do arquivo com data atual
            const dataAtual = new Date();
            const nomeArquivo = `trabalhos_${dataAtual.toISOString().split('T')[0]}.csv`;
            link.setAttribute('download', nomeArquivo);

            // Adicionar ao documento, clicar e remover
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);

            // Liberar o URL criado
            URL.revokeObjectURL(url);
        };

        // Configuração dos event listeners
        document.addEventListener('DOMContentLoaded', () => {
            // Os dados serão carregados apenas após autenticação
            // via função iniciarAplicacao()

            // Event listeners continuam sendo configurados
            document.getElementById('aplicarFiltros').addEventListener('click', aplicarFiltrosUsuario);
            document.getElementById('limparFiltros').addEventListener('click', limparFiltros);

            document.querySelectorAll('#tabelaTrabalhos th').forEach(th => {
                th.addEventListener('click', () => {
                    const coluna = th.getAttribute('data-coluna');
                    alternarOrdenacao(coluna);
                });
            });

            document.getElementById('itensPorPagina').addEventListener('change', (e) => {
                alterarItensPorPagina(parseInt(e.target.value, 10));
            });

            document.getElementById('gerarGrafico').addEventListener('click', gerarGraficoComFiltros);

            document.querySelectorAll('input[name="tipoGrafico"]').forEach(radio => {
                radio.addEventListener('change', atualizarSeletorEixos);
            });

            document.getElementById('exportarCSV').addEventListener('click', exportarCSV);

            atualizarSeletorEixos();
        });
    </script>
</body>

</html>